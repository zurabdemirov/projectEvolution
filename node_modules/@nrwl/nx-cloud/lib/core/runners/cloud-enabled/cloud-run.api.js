const a3_0xa42a=['package.json','axiosException','next','createMetricRecorder','RUNNER_FAILURE_PERF_ENTRY','@nrwl/nx-cloud','../../../utilities/nx-imports','Invalid\x20end\x20run\x20response','../../../utilities/metric-logger','Invalid\x20Nx\x20Cloud\x20response:\x20','message','Run\x20Details:','RunStart\x20duration','terminalOutput','getCIExecutionEnv','machineInfo','Run\x20completion\x20responded\x20with\x20`undefined`.','Invalid\x20end\x20run\x20response:\x20','createApiAxiosInstance','defaults','response','runContext','gzip','length','apiError','RunStart','note','extractErrorMessage','../../../utilities/environment','messages','assign','__awaiter','startRun','from','apiAxiosInstance','map','toString','apply','data','api','getBranch','string','stringify','throw','done','post','recordMetric','nxCloudVersion','mapRespToPerfEntry','createReqBody','/nx-cloud/runs/start','urls','runUrl','status','slice','success','printDuration','axiosMultipleTries','VERBOSE_LOGGING','Stack\x20Trace:','readFileSync','__esModule','then','value','parse','../../../utilities/axios','error','stack','CloudRunApi','endRun'];(function(_0x3bee9b,_0xa42aa){const _0x127e07=function(_0x1a280a){while(--_0x1a280a){_0x3bee9b['push'](_0x3bee9b['shift']());}};_0x127e07(++_0xa42aa);}(a3_0xa42a,0x15f));const a3_0x127e=function(_0x3bee9b,_0xa42aa){_0x3bee9b=_0x3bee9b-0x0;let _0x127e07=a3_0xa42a[_0x3bee9b];return _0x127e07;};'use strict';var __awaiter=this&&this[a3_0x127e('0x1e')]||function(_0x4c3696,_0x246429,_0x19fe0f,_0x236a5e){function _0x1bbd93(_0xa1c4bd){return _0xa1c4bd instanceof _0x19fe0f?_0xa1c4bd:new _0x19fe0f(function(_0x105993){_0x105993(_0xa1c4bd);});}return new(_0x19fe0f||(_0x19fe0f=Promise))(function(_0x371356,_0xb3676d){function _0x3b2fd5(_0x1384b7){try{_0x52520f(_0x236a5e['next'](_0x1384b7));}catch(_0x20fd92){_0xb3676d(_0x20fd92);}}function _0x575b05(_0x3f8eac){try{_0x52520f(_0x236a5e[a3_0x127e('0x2a')](_0x3f8eac));}catch(_0x4849c9){_0xb3676d(_0x4849c9);}}function _0x52520f(_0x2257bb){_0x2257bb[a3_0x127e('0x2b')]?_0x371356(_0x2257bb[a3_0x127e('0x3e')]):_0x1bbd93(_0x2257bb[a3_0x127e('0x3e')])[a3_0x127e('0x3d')](_0x3b2fd5,_0x575b05);}_0x52520f((_0x236a5e=_0x236a5e[a3_0x127e('0x24')](_0x4c3696,_0x246429||[]))[a3_0x127e('0x1')]());});};Object['defineProperty'](exports,a3_0x127e('0x3c'),{'value':!![]});exports[a3_0x127e('0x43')]=void 0x0;const axios_1=require(a3_0x127e('0x40'));const environment_1=require(a3_0x127e('0x1b'));const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require('util');const metric_logger_1=require(a3_0x127e('0x7'));const {output}=require(a3_0x127e('0x5'));class CloudRunApi{constructor(_0x1dc434,_0x3cd7a7,_0x4ff287,_0x33f034){this['messages']=_0x1dc434;this[a3_0x127e('0x14')]=_0x3cd7a7;this['machineInfo']=_0x33f034;this[a3_0x127e('0x21')]=(0x0,axios_1[a3_0x127e('0x11')])(_0x4ff287);}[a3_0x127e('0x1f')](_0x141f8a,_0x2adbe2){var _0x5f0633;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x127e('0x1c')]['apiError'])return{};const _0x27def5=(0x0,metric_logger_1[a3_0x127e('0x2')])(a3_0x127e('0x1f'));try{const _0x1bc663={'meta':{'nxCloudVersion':this[a3_0x127e('0x2e')]()},'branch':(0x0,environment_1[a3_0x127e('0x27')])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'ciExecutionId':(0x0,environment_1['getCIExecutionId'])(),'ciExecutionEnv':(0x0,environment_1[a3_0x127e('0xd')])(),'distributedExecutionId':_0x141f8a,'hashes':_0x2adbe2};if(environment_1['VERBOSE_LOGGING']){output[a3_0x127e('0x19')]({'title':a3_0x127e('0x18'),'bodyLines':['\x0a'+JSON[a3_0x127e('0x29')](_0x1bc663,null,0x2)]});}const _0x16481c=yield(0x0,axios_1[a3_0x127e('0x37')])(a3_0x127e('0xb'),()=>(0x0,axios_1[a3_0x127e('0x38')])(()=>this[a3_0x127e('0x21')][a3_0x127e('0x2c')](a3_0x127e('0x31'),_0x1bc663)));_0x27def5[a3_0x127e('0x2d')]((0x0,metric_logger_1[a3_0x127e('0x2f')])(_0x16481c));if(_0x16481c[a3_0x127e('0x25')]&&_0x16481c[a3_0x127e('0x25')]['message']){this['messages']['message']=_0x16481c[a3_0x127e('0x25')][a3_0x127e('0x9')];}if(!_0x16481c[a3_0x127e('0x25')]||!_0x16481c[a3_0x127e('0x25')][a3_0x127e('0x32')]){this[a3_0x127e('0x1c')][a3_0x127e('0x17')]=a3_0x127e('0x8')+JSON[a3_0x127e('0x29')](_0x16481c[a3_0x127e('0x25')]);return{};}return _0x16481c[a3_0x127e('0x25')][a3_0x127e('0x32')];}catch(_0x27a98d){_0x27def5[a3_0x127e('0x2d')](((_0x5f0633=_0x27a98d===null||_0x27a98d===void 0x0?void 0x0:_0x27a98d[a3_0x127e('0x0')])===null||_0x5f0633===void 0x0?void 0x0:_0x5f0633[a3_0x127e('0x13')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x27a98d[a3_0x127e('0x0')][a3_0x127e('0x13')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this[a3_0x127e('0x1c')]['apiError']=this['messages'][a3_0x127e('0x1a')](_0x27a98d,a3_0x127e('0x26'));return{};}});}[a3_0x127e('0x30')](_0xc16ad9,_0x10a1b0,_0x2a9c26,_0x5eeb3e){const _0x403df7=Object['assign'](Object[a3_0x127e('0x1d')]({'meta':{'nxCloudVersion':this[a3_0x127e('0x2e')]()},'tasks':_0x10a1b0,'run':_0xc16ad9,'linkId':_0x5eeb3e},_0x2a9c26),{'machineInfo':this[a3_0x127e('0xe')]});return JSON[a3_0x127e('0x29')](_0x403df7);}['endRun'](_0xdd4bb,_0x13cc22,_0x3a747f,_0xe46db4){var _0x4bd130,_0x5e58d7;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x127e('0x1c')]['apiError'])return![];let _0x3c36e9=this[a3_0x127e('0x30')](_0xdd4bb,_0x13cc22,_0x3a747f,_0xe46db4);if(_0x3c36e9[a3_0x127e('0x16')]>0x14*0x3e8*0x3e8){_0x3c36e9=this[a3_0x127e('0x30')](_0xdd4bb,_0x13cc22[a3_0x127e('0x22')](_0x477263=>Object[a3_0x127e('0x1d')](Object[a3_0x127e('0x1d')]({},_0x477263),{'hashDetails':undefined})),_0x3a747f,_0xe46db4);}const _0x10472a=Buffer[a3_0x127e('0x20')](_0x3c36e9);const _0x3b0142=yield(0x0,util_1['promisify'])(zlib_1[a3_0x127e('0x15')])(_0x10472a);const _0x252dd5=(0x0,metric_logger_1[a3_0x127e('0x2')])(a3_0x127e('0x44'));try{if(environment_1[a3_0x127e('0x39')]){const _0x4ec6d8=_0x13cc22['map'](_0x344c98=>{return Object[a3_0x127e('0x1d')](Object[a3_0x127e('0x1d')]({},_0x344c98),{'terminalOutput':_0x344c98[a3_0x127e('0xc')]?_0x344c98[a3_0x127e('0xc')][a3_0x127e('0x35')](0x0,0x14)+'...':undefined});});output['note']({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON[a3_0x127e('0x29')](_0x4ec6d8,null,0x2)]});}const _0x2d756c=yield(0x0,axios_1['printDuration'])('RunEnd\x20duration',()=>(0x0,axios_1[a3_0x127e('0x38')])(()=>this[a3_0x127e('0x21')][a3_0x127e('0x2c')]('/nx-cloud/runs/end',_0x3b0142,{'headers':Object['assign'](Object[a3_0x127e('0x1d')]({},this[a3_0x127e('0x21')][a3_0x127e('0x12')]['headers']),{'Content-Encoding':a3_0x127e('0x15'),'Content-Type':'application/octet-stream'})})));if(_0x2d756c){_0x252dd5[a3_0x127e('0x2d')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x2d756c));if(_0x2d756c['data']&&_0x2d756c[a3_0x127e('0x25')][a3_0x127e('0x33')]&&_0x2d756c['data'][a3_0x127e('0x34')]===a3_0x127e('0x36')){this[a3_0x127e('0x14')][a3_0x127e('0x33')]=_0x2d756c[a3_0x127e('0x25')][a3_0x127e('0x33')];return!![];}if(_0x2d756c[a3_0x127e('0x25')]&&_0x2d756c['data'][a3_0x127e('0x34')]){this['messages'][a3_0x127e('0x17')]=a3_0x127e('0x10')+JSON[a3_0x127e('0x29')](_0x2d756c[a3_0x127e('0x25')]['message']);}else if(_0x2d756c[a3_0x127e('0x25')]&&typeof _0x2d756c['data']===a3_0x127e('0x28')){if(_0x2d756c['data']!==a3_0x127e('0x36')){this[a3_0x127e('0x1c')][a3_0x127e('0x17')]=a3_0x127e('0x10')+JSON[a3_0x127e('0x29')](_0x2d756c[a3_0x127e('0x25')]);}}else{this[a3_0x127e('0x1c')][a3_0x127e('0x17')]=a3_0x127e('0x10')+JSON['stringify'](_0x2d756c['data']);}if(environment_1['VERBOSE_LOGGING']){output[a3_0x127e('0x19')]({'title':a3_0x127e('0x6'),'bodyLines':[JSON[a3_0x127e('0x29')](_0x2d756c[a3_0x127e('0x25')],null,0x2)]});}}else{output[a3_0x127e('0x41')]({'title':'Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','bodyLines':[a3_0x127e('0xf'),a3_0x127e('0xa'),JSON[a3_0x127e('0x29')](_0xdd4bb,null,0x2),a3_0x127e('0x3a'),JSON['stringify'](new Error()[a3_0x127e('0x42')],null,0x2)]});}return![];}catch(_0x52cdeb){_0x252dd5[a3_0x127e('0x2d')](((_0x4bd130=_0x52cdeb===null||_0x52cdeb===void 0x0?void 0x0:_0x52cdeb[a3_0x127e('0x0')])===null||_0x4bd130===void 0x0?void 0x0:_0x4bd130['response'])?(0x0,metric_logger_1[a3_0x127e('0x2f')])(_0x52cdeb['axiosException'][a3_0x127e('0x13')]):metric_logger_1[a3_0x127e('0x3')]);const _0x3ac4c8=(_0x5e58d7=_0x52cdeb[a3_0x127e('0x0')])!==null&&_0x5e58d7!==void 0x0?_0x5e58d7:_0x52cdeb;this[a3_0x127e('0x1c')]['apiError']=this[a3_0x127e('0x1c')][a3_0x127e('0x1a')](_0x3ac4c8,'api');return![];}});}[a3_0x127e('0x2e')](){try{const _0x39908b=JSON[a3_0x127e('0x3f')]((0x0,fs_1[a3_0x127e('0x3b')])(a3_0x127e('0x45'))[a3_0x127e('0x23')]());return _0x39908b['devDependencies'][a3_0x127e('0x4')];}catch(_0x26e713){return'unknown';}}}exports[a3_0x127e('0x43')]=CloudRunApi;