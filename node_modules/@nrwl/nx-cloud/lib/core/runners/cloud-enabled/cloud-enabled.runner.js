const a1_0x46c7=['agentRunningInDistributedExecution','warn','cacheableOperations','./cloud-remote-cache','Task\x20with\x20hash\x20','https://nx.app','../../api/error-reporter.api','assign','writeFileSync','cloudEnabledTasksRunner','printMessages','taskId','uploadedToStorage','storedHashes','\x20isn\x27t\x20recorded','local-cache-hit','value','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','toString','env','/runs/','EndOfRunMessage','CloudEnabledLifeCycle','lifeCycle','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','accessToken','note','./cloud-run.api','VERBOSE_LOGGING','./cloud-enabled-life-cycle','parseCommand','startRun','store','skipNxCache','CloudRunApi','obfuscate','next','error','encryptionKey','./id-generator','runUrl','all','__esModule','Executed\x20tasks\x20with\x20hashes:\x20','getNxCacheDirectory','throw','getCIExecutionId','map','subscribe','OutputObfuscator','exit','toISOString','anyErrors','getMachineInfo','../../../utilities/environment','printCacheHitsMessage','.commit','url','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','waitForStoreRequestsToComplete','fs-extra','stringify','processInBackground','__awaiter','submitRunMetrics','../../../utilities/metric-logger','requests','defineProperty','../../file-storage/e2e-encryption','@nrwl/nx-cloud/lib/daemon/process-run-end','length','endRun','cloud-enabled-runner','extractGitSha','filter','pathExists','Nx\x20Cloud\x20Problems','delayedStoreRequests','hash','complete','getCIExecutionEnv','message','daemon','rxjs/internal/Subject','FileStorage','apply','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','ENCRYPTION_KEY','catch','cacheStatus','ErrorReporterApi','path','tasks-hashes-'];(function(_0x94b1bc,_0x46c756){const _0x3d398e=function(_0x101b0e){while(--_0x101b0e){_0x94b1bc['push'](_0x94b1bc['shift']());}};_0x3d398e(++_0x46c756);}(a1_0x46c7,0x8b));const a1_0x3d39=function(_0x94b1bc,_0x46c756){_0x94b1bc=_0x94b1bc-0x0;let _0x3d398e=a1_0x46c7[_0x94b1bc];return _0x3d398e;};'use strict';var __awaiter=this&&this[a1_0x3d39('0x11')]||function(_0x394bea,_0x1d7e07,_0x4f6c92,_0x267538){function _0x4c149c(_0x499ac5){return _0x499ac5 instanceof _0x4f6c92?_0x499ac5:new _0x4f6c92(function(_0x4caabe){_0x4caabe(_0x499ac5);});}return new(_0x4f6c92||(_0x4f6c92=Promise))(function(_0x526143,_0x1efb73){function _0x593a69(_0x57b6dc){try{_0x282b7e(_0x267538[a1_0x3d39('0x53')](_0x57b6dc));}catch(_0x35b4d2){_0x1efb73(_0x35b4d2);}}function _0x11d636(_0xc07a92){try{_0x282b7e(_0x267538[a1_0x3d39('0x5c')](_0xc07a92));}catch(_0x248bd3){_0x1efb73(_0x248bd3);}}function _0x282b7e(_0x134e14){_0x134e14['done']?_0x526143(_0x134e14[a1_0x3d39('0x3f')]):_0x4c149c(_0x134e14['value'])['then'](_0x593a69,_0x11d636);}_0x282b7e((_0x267538=_0x267538[a1_0x3d39('0x27')](_0x394bea,_0x1d7e07||[]))[a1_0x3d39('0x53')]());});};Object[a1_0x3d39('0x15')](exports,a1_0x3d39('0x59'),{'value':!![]});exports[a1_0x3d39('0x38')]=void 0x0;const message_reporter_1=require('../../terminal-output/message-reporter');const end_of_run_message_1=require('../../terminal-output/end-of-run-message');const output_obfuscator_1=require('../../terminal-output/output-obfuscator');const cloud_enabled_life_cycle_1=require(a1_0x3d39('0x4c'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require(a1_0x3d39('0x16'));const environment_1=require(a1_0x3d39('0x8'));const cloud_remote_cache_1=require(a1_0x3d39('0x32'));const cloud_run_api_1=require(a1_0x3d39('0x4a'));const fs_1=require('fs');const path=require(a1_0x3d39('0x2d'));const path_1=require(a1_0x3d39('0x2d'));const metric_logger_1=require(a1_0x3d39('0x13'));const error_reporter_api_1=require(a1_0x3d39('0x35'));const fs_extra_1=require(a1_0x3d39('0xe'));const id_generator_1=require(a1_0x3d39('0x56'));const {tasksRunner,output}=require('../../../utilities/nx-imports');function createApi(_0x5f5aeb,_0x257abb,_0x36497c){const _0xa7de87=(0x0,environment_1[a1_0x3d39('0x7')])(_0x257abb);return new cloud_run_api_1[(a1_0x3d39('0x51'))](_0x5f5aeb,_0x36497c,_0x257abb,_0xa7de87);}function storeTaskHashes(_0x49468c,_0x8a617e,_0x5969b7){const _0x414e60=JSON[a1_0x3d39('0xf')](_0x49468c['map'](_0xcc71e5=>({'taskId':_0xcc71e5[a1_0x3d39('0x3a')],'hash':_0xcc71e5[a1_0x3d39('0x20')]})));if(environment_1[a1_0x3d39('0x4b')]){output[a1_0x3d39('0x49')]({'title':a1_0x3d39('0x5a')+_0x414e60});}(0x0,fs_1[a1_0x3d39('0x37')])(path['join'](_0x8a617e,a1_0x3d39('0x2e')+_0x5969b7),_0x414e60);}function storeLocalCacheHits(_0x2e5423,_0x1b7fb0,_0x21be31){const _0x150bb0=_0x2e5423[a1_0x3d39('0x1c')](_0xcae351=>_0xcae351[a1_0x3d39('0x2b')]===a1_0x3d39('0x3e'))[a1_0x3d39('0x1')](_0x7603e6=>_0x7603e6[a1_0x3d39('0x20')]);_0x150bb0['forEach'](_0x45c36f=>_0x1b7fb0[a1_0x3d39('0x4f')](_0x45c36f,_0x21be31));}function onComplete({daemon,options,fileStorage,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,storeInCurrentProcess,distributedExecutionId,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1a4468=new Date()[a1_0x3d39('0x5')]();const _0x1729a4=(0x0,environment_1['getBranch'])();const _0x5dbcf4={'command':outputObfuscator[a1_0x3d39('0x52')]((0x0,environment_1[a1_0x3d39('0x4d')])()),'startTime':runStartTime,'endTime':_0x1a4468,'distributedExecutionId':distributedExecutionId,'branch':_0x1729a4,'runGroup':(0x0,environment_1['getRunGroup'])(),'sha':_0x1729a4?(0x0,environment_1[a1_0x3d39('0x1b')])():undefined,'inner':inner};const _0x45ef2b={'branch':_0x1729a4,'runGroup':(0x0,environment_1['getRunGroup'])(),'ciExecutionId':(0x0,environment_1[a1_0x3d39('0x0')])(),'ciExecutionEnv':(0x0,environment_1[a1_0x3d39('0x22')])()};if(storeInCurrentProcess){if((0x0,environment_1['agentRunningInDistributedExecution'])(distributedExecutionId)){const _0xbf8901=(0x0,environment_1[a1_0x3d39('0x5b')])(options);storeTaskHashes(taskExecutions,_0xbf8901,distributedExecutionId);storeLocalCacheHits(taskExecutions,remoteCache,_0xbf8901);}try{yield remoteCache[a1_0x3d39('0xd')]();}catch(_0x155956){output[a1_0x3d39('0x54')]({'title':a1_0x3d39('0xc')});messages[a1_0x3d39('0x39')]();return![];}for(const _0x315039 of fileStorage[a1_0x3d39('0x3c')]){const _0x1eeafd=taskExecutions['find'](_0x2f21b6=>_0x2f21b6['hash']===_0x315039);if(!_0x1eeafd){throw new Error(a1_0x3d39('0x33')+_0x315039+a1_0x3d39('0x3d'));}_0x1eeafd[a1_0x3d39('0x3b')]=!![];}try{yield api[a1_0x3d39('0x19')](_0x5dbcf4,taskExecutions,_0x45ef2b);}catch(_0x333ada){output[a1_0x3d39('0x54')]({'title':a1_0x3d39('0x40')});messages[a1_0x3d39('0x39')]();return![];}yield(0x0,metric_logger_1[a1_0x3d39('0x12')])(options);}else{try{const _0x5d3ffc=environment_1['ACCESS_TOKEN']?environment_1['ACCESS_TOKEN']:options[a1_0x3d39('0x48')];const _0x19e346=(0x0,id_generator_1['generateUniqueLinkId'])();yield daemon[a1_0x3d39('0x10')](a1_0x3d39('0x17'),{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x3d39('0x36')](Object[a1_0x3d39('0x36')]({},options),{'accessToken':_0x5d3ffc}),'delayedStoreRequests':remoteCache[a1_0x3d39('0x1f')],'ciExecutionContext':_0x45ef2b,'runEnd':{'runData':_0x5dbcf4,'taskExecutions':taskExecutions,'linkId':_0x19e346}});runContext[a1_0x3d39('0x57')]=(options[a1_0x3d39('0xb')]||a1_0x3d39('0x34'))+a1_0x3d39('0x43')+_0x19e346;}catch(_0x3cf3e0){output[a1_0x3d39('0x30')]({'title':a1_0x3d39('0x1e'),'bodyLines':[_0x3cf3e0[a1_0x3d39('0x23')]||_0x3cf3e0[a1_0x3d39('0x41')]()]});return![];}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x3d39('0x39')]();if(!messages['anyErrors']&&!inner){endOfRunMessage[a1_0x3d39('0x9')]();}},0x0);}else{messages['printMessages']();if(!messages[a1_0x3d39('0x6')]&&!inner){endOfRunMessage[a1_0x3d39('0x9')]();}}return!![];});}function createLifeCycle(_0x483577,_0x59d0de,_0x515593,_0x4aa234){const _0x535915=new cloud_enabled_life_cycle_1[(a1_0x3d39('0x45'))](_0x483577,(0x0,environment_1[a1_0x3d39('0x5b')])(_0x59d0de),!![],_0x59d0de[a1_0x3d39('0x31')]||[],_0x515593,_0x4aa234);try{const {CompositeLifeCycle}=require('../../../utilities/nx-imports');if(!CompositeLifeCycle)return _0x535915;return new CompositeLifeCycle([_0x59d0de[a1_0x3d39('0x46')],_0x535915]);}catch(_0x31e226){return _0x535915;}}function fetchUrlsForKnownHashesUpfront(_0x45378f,_0x302ce1,_0xd8ceca,_0x157b97,_0x5c87e1){return __awaiter(this,void 0x0,void 0x0,function*(){if(_0x157b97[a1_0x3d39('0x50')])return;let _0x4ee95e=_0xd8ceca['map'](_0x5aec08=>_0x5aec08[a1_0x3d39('0x20')])[a1_0x3d39('0x1c')](_0x517dc3=>!!_0x517dc3);const _0x96ed3b=(0x0,environment_1[a1_0x3d39('0x5b')])(_0x157b97);const _0x562bcf=yield Promise[a1_0x3d39('0x58')](_0x4ee95e['map'](_0x56ecda=>{const _0x3f3ac9=(0x0,path_1['join'])(_0x96ed3b,_0x56ecda+a1_0x3d39('0xa'));return(0x0,fs_extra_1[a1_0x3d39('0x1d')])(_0x3f3ac9);}));const _0x3d6474=[];for(let _0xdb44c9=0x0;_0xdb44c9<_0x562bcf[a1_0x3d39('0x18')];++_0xdb44c9){if(!_0x562bcf[_0xdb44c9]){_0x3d6474['push'](_0x4ee95e[_0xdb44c9]);}}if(_0x3d6474[a1_0x3d39('0x18')]>0x0){const _0x239163=_0x45378f[a1_0x3d39('0x4e')](_0x5c87e1,_0x3d6474);for(const _0x4b3876 of _0x3d6474){_0x302ce1[a1_0x3d39('0x14')][_0x4b3876]=_0x239163;}}});}function cloudEnabledTasksRunner(_0x22d371,_0x106fcc,_0x518da9,_0xa8fb48=![]){var _0x57c42d;const _0x37975a=process[a1_0x3d39('0x42')]['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'];const _0x1f24bf={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x22d371};const _0x3dc671=_0x106fcc['lifeCycle']===undefined;const _0x169a1a=[];const _0x137e54=new message_reporter_1['MessageReporter'](_0x106fcc);const _0x2cd4a1=createApi(_0x137e54,_0x106fcc,_0x1f24bf);const _0x310ac7=new end_of_run_message_1[(a1_0x3d39('0x44'))](_0x1f24bf,_0x169a1a,_0x37975a);const _0x1aef56=new output_obfuscator_1[(a1_0x3d39('0x3'))](_0x106fcc['maskedProperties']);const _0x2c4ef2=new Date()[a1_0x3d39('0x5')]();const _0x437250=createLifeCycle(_0x1f24bf,_0x106fcc,_0x1aef56,_0x169a1a);const _0x425dac=environment_1[a1_0x3d39('0x29')]||_0x106fcc[a1_0x3d39('0x55')];const _0x11f187=new e2e_encryption_1['E2EEncryption'](_0x425dac);const _0x43c93d=new error_reporter_api_1[(a1_0x3d39('0x2c'))](_0x106fcc);const _0x11ebb8=(0x0,environment_1[a1_0x3d39('0x2f')])(_0x37975a)||!((_0x57c42d=_0x518da9[a1_0x3d39('0x24')])===null||_0x57c42d===void 0x0?void 0x0:_0x57c42d['enabled']());const _0x58a3ed=new file_storage_1[(a1_0x3d39('0x26'))](_0x11f187,_0x43c93d,_0x106fcc,a1_0x3d39('0x1a'));const _0x6c6ee4=new cloud_remote_cache_1['CloudRemoteCache'](_0x137e54,_0x2cd4a1,_0x1f24bf,_0x58a3ed,_0x37975a,_0x11ebb8);fetchUrlsForKnownHashesUpfront(_0x2cd4a1,_0x1f24bf,_0x22d371,_0x106fcc,_0x37975a);delete process[a1_0x3d39('0x42')][a1_0x3d39('0x28')];const _0x28fe31=tasksRunner(_0x22d371,Object['assign'](Object[a1_0x3d39('0x36')]({},_0x106fcc),{'remoteCache':_0x6c6ee4,'lifeCycle':_0x437250}),_0x518da9);if(_0x28fe31[a1_0x3d39('0x2')]){const {Subject}=require(a1_0x3d39('0x25'));const _0x1f4baa=new Subject();_0x28fe31['subscribe']({'next':_0x573795=>_0x1f4baa['next'](_0x573795),'error':_0x3731dd=>_0x1f4baa[a1_0x3d39('0x54')](_0x3731dd),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x2bd4ee=yield onComplete({'daemon':_0x518da9[a1_0x3d39('0x24')],'options':_0x106fcc,'fileStorage':_0x58a3ed,'remoteCache':_0x6c6ee4,'api':_0x2cd4a1,'outputObfuscator':_0x1aef56,'runStartTime':_0x2c4ef2,'messages':_0x137e54,'endOfRunMessage':_0x310ac7,'taskExecutions':_0x169a1a,'versionOfNxBefore133':_0x3dc671,'inner':_0xa8fb48,'encryptionKey':_0x425dac,'storeInCurrentProcess':_0x11ebb8,'runContext':_0x1f24bf,'distributedExecutionId':_0x37975a});if(!_0x2bd4ee&&(0x0,environment_1[a1_0x3d39('0x2f')])(_0x37975a)){process['exit'](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}_0x1f4baa[a1_0x3d39('0x21')]();})});return _0x1f4baa;}else{return _0x28fe31['then'](_0x198fc7=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x309c04=yield onComplete({'daemon':_0x518da9[a1_0x3d39('0x24')],'options':_0x106fcc,'fileStorage':_0x58a3ed,'remoteCache':_0x6c6ee4,'api':_0x2cd4a1,'outputObfuscator':_0x1aef56,'runStartTime':_0x2c4ef2,'messages':_0x137e54,'endOfRunMessage':_0x310ac7,'taskExecutions':_0x169a1a,'versionOfNxBefore133':_0x3dc671,'inner':_0xa8fb48,'encryptionKey':_0x425dac,'storeInCurrentProcess':_0x11ebb8,'runContext':_0x1f24bf,'distributedExecutionId':_0x37975a});if(!_0x309c04&&(0x0,environment_1[a1_0x3d39('0x2f')])(_0x37975a)){process['exit'](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}return _0x198fc7;}))[a1_0x3d39('0x2a')](_0x3fa281=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x1ab69f=yield onComplete({'daemon':_0x518da9[a1_0x3d39('0x24')],'options':_0x106fcc,'fileStorage':_0x58a3ed,'remoteCache':_0x6c6ee4,'api':_0x2cd4a1,'outputObfuscator':_0x1aef56,'runStartTime':_0x2c4ef2,'messages':_0x137e54,'endOfRunMessage':_0x310ac7,'taskExecutions':_0x169a1a,'versionOfNxBefore133':_0x3dc671,'inner':_0xa8fb48,'encryptionKey':_0x425dac,'storeInCurrentProcess':_0x11ebb8,'runContext':_0x1f24bf,'distributedExecutionId':_0x37975a});if(!_0x1ab69f&&(0x0,environment_1[a1_0x3d39('0x2f')])(_0x37975a)){process[a1_0x3d39('0x4')](environment_1[a1_0x3d39('0x47')]);}throw _0x3fa281;}));}}exports[a1_0x3d39('0x38')]=cloudEnabledTasksRunner;